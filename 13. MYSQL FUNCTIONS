<?php
// Step 1: Connect to database
$conn = new mysqli("localhost", "root", "", "studentdetails");

// Check connection
if ($conn->connect_error) {
    die("Connection failed: " . $conn->connect_error);
}

// Step 2: Handle form submission to add a new student
if(isset($_POST['submit'])){
    $name = $_POST['name'];
    $grade = $_POST['grade'];

    $sql = "INSERT INTO studentstime (name, grade) VALUES ('$name', '$grade')";
    if($conn->query($sql) === TRUE){
        $message = "<p style='color:green;'>✅ Student added successfully!</p>";
    } else {
        $message = "<p style='color:red;'>❌ Error: " . $conn->error . "</p>";
    }
}
?>

<!DOCTYPE html>
<html>
<head>
    <title>Student Management with MySQL Functions</title>
    <style>
        body { font-family: Arial, sans-serif; background: #f4f6f9; padding: 20px; }
        .container { width: 700px; margin: auto; background: #fff; padding: 25px; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);}
        h2 { color: #333; margin-top: 30px; }
        input[type="text"], input[type="submit"] { padding: 10px; width: 95%; margin: 8px 0; border: 1px solid #ccc; border-radius: 5px; }
        input[type="submit"] { background: #007BFF; color: white; cursor: pointer; width: 100%; }
        input[type="submit"]:hover { background: #0056b3; }
        table { border-collapse: collapse; width: 100%; margin-top: 15px; }
        table, th, td { border: 1px solid #ddd; }
        th { background: #007BFF; color: white; padding: 10px; }
        td { padding: 10px; text-align: center; }
        .success { color: green; font-weight: bold; }
        .error { color: red; font-weight: bold; }
        .stats { margin-top: 20px; }
    </style>
</head>
<body>
<div class="container">
    <h2>Add New Student</h2>
    <?php if(!empty($message)) echo $message; ?>
    <form method="post">
        <input type="text" name="name" placeholder="Enter Student Name" maxlength="25" required>
        <input type="text" name="grade" placeholder="Enter Grade" maxlength="10" required>
        <input type="submit" name="submit" value="Add Student">
    </form>

    <h2>All Students</h2>
    <?php
    $result = $conn->query("SELECT * FROM studentstime");

    if($result->num_rows > 0){
        echo "<table>";
        echo "<tr><th>ID</th><th>Name</th><th>Grade</th></tr>";
        while($row = $result->fetch_assoc()){
            echo "<tr>
                    <td>".$row['id']."</td>
                    <td>".$row['name']."</td>
                    <td>".$row['grade']."</td>
                  </tr>";
        }
        echo "</table>";
    } else {
        echo "<p>No students found.</p>";
    }

    // Step 5: MySQL Functions Examples
    $count = $conn->query("SELECT COUNT(*) AS total_students FROM studentstime")->fetch_assoc()['total_students'];
    $max = $conn->query("SELECT MAX(grade) AS max_grade FROM studentstime")->fetch_assoc()['max_grade'];
    $min = $conn->query("SELECT MIN(grade) AS min_grade FROM studentstime")->fetch_assoc()['min_grade'];
    $avg = $conn->query("SELECT AVG(grade) AS avg_grade FROM studentstime")->fetch_assoc()['avg_grade'];
    ?>
    
    <div class="stats">
        <h2>Student Statistics</h2>
        <p><strong>Total Students:</strong> <?php echo $count; ?></p>
        <p><strong>Highest Grade:</strong> <?php echo $max; ?></p>
        <p><strong>Lowest Grade:</strong> <?php echo $min; ?></p>
        <p><strong>Average Grade:</strong> <?php echo round($avg, 2); ?></p>
    </div>

    <?php $conn->close(); ?>
</div>
</body>
</html>


